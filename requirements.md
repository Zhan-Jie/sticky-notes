# 桌面便签（Sticky Notes）产品设计方案（草案）

面向平台：deepin v25（基于 Debian 的桌面系统，DDE）

## 1. 背景与问题
在工作/编码过程中，人容易被临时打断（消息、会议、排查、同事沟通）。回来后经常忘记“刚刚正在做什么/下一步是什么”，需要重新上下文切换，成本很高。

目标是用一个始终可见、轻量、低干扰的桌面置顶便签，承载“当前进行中的少量任务”，帮助恢复上下文与保持专注。

## 2. 目标 / 非目标
### 目标（MVP）
- 任何时候都能一眼看到“当前要做的少量事情”（最多 5 条）
- 让“当前正在进行的那一条”更醒目，帮助被打断后快速恢复上下文
- 为每条任务提供“上下文记录”，方便补充难点/下一步/关键结论，快速回忆思路
- 便签窗口可置顶、无标题栏、可调半透明，不遮挡主要工作区域
- 任务可快速新增、标记完成、删除；数据可持久化（重启后仍在）
- 启动快、资源占用低、离线可用、默认不联网

### 非目标（先不做）
- 不做“待办管理工具”（不追求海量任务、复杂分类/优先级/到期日）
- 多端同步/账号体系/云端备份
- 复杂的 GTD/日历/提醒/番茄钟体系（多阶段/报表/统计）一体化
- 类 Notion 的富文本/知识库

## 3. 用户画像与核心场景
### 用户画像
- 开发者/运维/产品/测试等需要频繁切换上下文的知识工作者
- 桌面常驻工具使用者，喜欢“随时可见、随手记录”

### 核心场景（Top 3）
1) 正在排查一个 bug：记录“已验证/下一步要试什么”，避免被打断后重复劳动  
2) 写代码/写文档：记录当前小步骤与 TODO，避免思路丢失  
3) 多任务并行：把“当前进行中”的任务固定在桌面角落，随时对齐优先级

## 4. 交互与信息架构
### 便签窗口（主窗）
- 单窗口常驻：默认右上角（可记忆上次位置）
- 无窗口标题栏；支持拖拽移动（例如拖拽卡片空白区域）；支持调整大小（可选：锁定大小）
- 支持置顶开关（默认开启）
- 支持半透明调节（例如 30%~100%，默认 85%）
- 支持“仅显示未完成”开关（默认开启）

### 任务列表（核心）
- 任务项：`[ ] 文本` + 状态区（必要时显示倒计时/超时）
- 极简原则：光标未移入任务项（hover）/未选中时，不常驻展示按钮组，避免干扰
- 操作入口：仅在 hover/选中该任务时，显示右侧快捷按钮（记录/开始/暂停/重置计时）
- 数量上限：最多 5 条（达到上限时禁止新增或给出明确提示）
- 新增：输入框回车新增；支持多行粘贴（按行拆分，可选，超过 5 条截断并提示）
- 编辑：双击或直接行内编辑（按你的偏好二选一）
- 完成：勾选即完成；完成项可折叠/隐藏
- 删除：支持删除；建议提供“撤销（5 秒）”降低误删成本

### 任务上下文记录（用于“恢复思路”）
- 入口：点击任务右侧“记录”按钮，打开一个更大的多行输入区域（非半透明，便于阅读与输入）
- 内容：用于记录该任务的难点、已验证结论、下一步要做什么、待确认问题等（纯文本即可）
- 交互：
  - 点击窗口外任意位置自动隐藏（不关闭/退出应用，只是收起编辑窗口）
  - `Esc` 隐藏；`Ctrl+Enter` 可选：保存并隐藏
  - 自动保存（输入即保存或失焦保存，二选一；建议失焦保存，减少磁盘写入）
- 视觉：
  - 编辑窗口背景为实色（不透明），与半透明便签形成“记录时专注、回到便签时轻量”的对比
  - 若某任务已存在记录，在任务项上提供轻量提示（例如小圆点/图标），便于识别

### 当前任务与简易番茄钟（聚焦增强）
- 约束：同一时刻只允许 1 个任务处于“计时中/进行中”状态（其余任务自动为暂停）
- UI：当前任务高亮（例如更高对比度、左侧高亮条、轻微呼吸动效/进度环其一）
- 状态区（常驻但克制）：
  - running：显示倒计时（例如 `12:34`）
  - overtime：显示超时累计（例如 `超时 03:12`）
- 计时按钮（仅 hover/选中时显示，并随状态变化，避免冗余）：
  - idle：显示 `开始`、`重置`（可选：隐藏重置）
  - running（倒计时中）：不显示 `开始`；仅显示 `暂停`、`重置`
  - paused：显示 `开始`、`重置`
  - overtime：显示 `开始`（继续计超时）与 `重置`（回到专注计时）；可选显示 `暂停`
- 到点反馈：默认发送系统通知（可关闭）；同时在卡片内展示状态
- 到点后的状态（关键规则）：
  - 任务计时归零时，不自动标记完成
  - 任务置灰，并自动移动到待办列表底部
  - 显示“超时”标签，并开始显示超时计时（例如 `超时 03:12`，从 00:00 向上累计）
  - 用户可对该任务继续：开始（继续计超时）、重置（回到专注计时）、或直接勾选完成

### 快捷键（强烈建议）
为“尽量不打断手部操作”：
- `Ctrl+Alt+N`：聚焦/唤起便签（或切换显示/隐藏）
- `Ctrl+Enter`：快速新增任务（当焦点在输入框）
- `Ctrl+Alt+T`：切换置顶
（具体快捷键可在 deepin 上验证是否冲突，最终可配置）

### 托盘与自启动（建议作为 MVP+）
- 托盘图标：显示/隐藏、置顶开关、透明度快速滑条、退出
- 开机自启动（可配置）

## 5. 功能需求（分期）
### P0（MVP 必须）
- 单便签窗口：置顶、拖拽、记忆位置/大小
- 半透明显示（实现方式见技术方案）
- 任务 CRUD：新增/编辑/完成/删除（最多 5 条）
- 当前任务高亮：支持一键切换“当前进行中任务”（哪怕不启用计时也能高亮）
- 简易番茄钟：每条任务提供开始/暂停/重置计时（同一时刻仅 1 条计时）
- 任务上下文记录：每条任务支持打开多行记录窗口；点击窗口外自动隐藏；内容持久化
- 本地持久化：重启系统后数据仍在
- 设置项：置顶、透明度、仅显示未完成、字体大小（至少 1 个可调）
- 专注时长设置：允许在设置中修改默认专注时长（分钟）

### P1（增强体验）
- 撤销删除 / 批量清理已完成
- 托盘入口 + 开机自启动
- 导入/导出（JSON）

### P2（进阶）
- 任务排序（拖拽）
- 统计与复盘（今日完成数、连续完成天数）
- 同步/备份（谨慎引入，优先保证离线与隐私）

## 6. 视觉与交互细节建议
- “低干扰”：默认不抢焦点、不弹窗、不主动提醒
- “可读但不抢眼”：使用柔和背景（米黄/浅灰），字体清晰，间距充足
- 支持两种模式：
  - 专注模式：只显示未完成（默认）
  - 回顾模式：显示已完成（用于收尾/清理）

## 7. 数据与配置
### 数据模型（建议）
- Note（便签）：
  - id, title（可空）, position(x,y), size(w,h), opacity, alwaysOnTop, createdAt, updatedAt
- Task（任务）：
  - id, noteId, text, status(todo/done), createdAt, doneAt, order
  - contextText(任务上下文记录，纯文本), contextUpdatedAt
  - focusState(idle/running/paused/overtime)
  - focusDurationSec(默认值), focusRemainingSec
  - overtimeSec(累计超时秒数)
  - lastTickAt
- Settings（全局）：
  - hotkeys, launchAtStartup, theme, showOnlyTodoDefault
  - defaultFocusMinutes(可配置), enableSystemNotification(默认 true), enableSound

### 存储位置（deepin / Linux 约定）
- 使用应用数据目录（例如 `~/.local/share/<app>` 或 Flutter 的 app support dir）
- 配置与数据分离（settings vs tasks）

## 8. 技术方案（Flutter，已确认）
适用原因：
- 你本机已安装 Flutter 环境，上手和迭代速度快
- UI 表达力强，做“轻量、美观、可拖拽”的便签体验很合适
- 后续若要支持 Windows/macOS，复用度高

需要重点验证/处理的桌面能力（这是 Flutter Linux 的关键点）：
- 置顶、窗口位置/大小持久化、无边框/自绘标题栏
- 半透明效果：
  - 优先用 UI 透明度实现（背景色/卡片透明度），通常在合成器下即可看到“透出后面的窗口”
  - 若你期望“真正的透明窗口/模糊玻璃效果”，可能需要额外插件或自定义 Linux runner（GTK）能力，建议先做 MVP 再增强
- 系统托盘、全局快捷键、开机自启动：依赖插件生态，需在 deepin 上实测稳定性

工程建议（不强制）：
- 状态管理：Riverpod（或 Bloc），保持简单
- 本地存储：优先 Hive/Isar（简单）或 SQLite（可控、可迁移）
- 打包发布：`flutter build linux --release` + 制作 `.deb`（deepin 友好）

风险与处理：
- 若 Flutter Linux 在 deepin 上出现“置顶/无标题栏/系统通知”等集成问题，优先通过插件替换或自定义 Linux runner（GTK）解决，保持整体技术栈不切换。

## 9. 已确认的关键决策
1) 专注时长：允许在设置中修改默认专注时长（分钟）
2) 到点提醒：默认发送系统通知（可在设置中关闭）
3) 到点处理：任务置灰并下沉到底部，显示“超时”并开始累计超时计时
